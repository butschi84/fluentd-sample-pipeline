<label @FILTER_PIPELINE1>
    # filter the logs with tag syslog (syslog.**)

    # whitelist filter
    # ----------------
    # <filter syslog.**>
    #     @type grep
    #     <regexp>
    #         key message
    #         pattern /(?=.*(field=\w*)\b)/ # match logs like 'blabla field=some_value blabla'
    #     </regexp>
    # </filter>
    # <filter syslog.**>
    #     @type grep
    #     regexp1 message syslog\.syslog\.notice # only notice messages
    # </filter>

    
    <filter syslog.**>
        @type record_transformer
        <record>
            hostname "#{Socket.gethostname}"
            tag ${tag}
        </record>

        # whitelist filters
        # <regexp>
        #     key message
        #     pattern1 /(?=.*(field=\w*)\b)/ # match logs like 'blabla field=some_value blabla'
        # </regexp>
        
        # blacklist filters
        # -----------------
        <exclude>
            key tag
            pattern /syslog\.syslog\.debug/
        </exclude>
    </filter>

    <filter syslog.**>
        type parser
        key_name message
        reserve_data true
        <parse>
            @type regexp
            expression /(?=.*field=(?<myfield>\w*)\b)/
        </parse>  
    </filter>    

    # forward logs to 03-dispatch
    <match syslog.**>
        @type relabel
        @label @DISPATCH_PIPELINE1
    </match>
</label>